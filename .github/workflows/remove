name: Flexible Repository Cleanup

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Delete Files and Folders with Exclusions
        run: |
          echo "Starting selective cleanup..."
          
          # 'find' ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶´‡¶æ‡¶á‡¶≤/‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§
          # ! -name '‡¶®‡¶æ‡¶Æ' ‡¶Æ‡¶æ‡¶®‡ßá ‡¶π‡¶≤‡ßã ‡¶è‡¶á ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§
          
          find . -maxdepth 1 \
            ! -name '.github' \
            ! -name '.git' \
            ! -name '.' \
            -exec rm -rf {} +

          # üí° ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: images ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞), 
          # ‡¶§‡¶¨‡ßá ‡¶â‡¶™‡¶∞‡ßá ! -name 'images' \ ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
          # ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá‡¶®, ‡¶∂‡ßá‡¶∑ ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∏‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ (\) ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

          echo "Cleanup finished successfully!"

      - name: Save and Push Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add -A
          
          if git diff --quiet && git diff --staged --quiet; then
            echo "Nothing to commit, repository is already clean."
          else
            git commit -m "chore: cleanup repository (preserved workflows and specific files)"
            git push origin main
          fi
